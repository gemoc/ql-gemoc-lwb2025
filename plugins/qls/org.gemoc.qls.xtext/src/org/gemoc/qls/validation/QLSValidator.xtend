/*
 * generated by Xtext 2.31.0
 */
package org.gemoc.qls.validation

import org.gemoc.qls.qLS.Import
import org.eclipse.xtext.validation.Check
import org.gemoc.qls.utils.QLSUtils
import org.gemoc.qls.qLS.QLSPackage

/**
 * This class contains custom validation rules. 
 * 
 * See https://www.eclipse.org/Xtext/documentation/303_runtime_concepts.html#validation
 */
class QLSValidator extends AbstractQLSValidator {

	public static final String INVALID_URI = "invalidURI";

	@Check
	def checkImport(Import imp) {
		// check file exist
		if (imp.importURI !== null) {
			if (imp.importURI.startsWith("/")) {
				error("Invalid URI format " + imp.importURI + ", maybe \"platform:\" prefix is missing", imp,
					imp.eClass.getEStructuralFeature(QLSPackage.IMPORT__IMPORT_URI), INVALID_URI)
			}
			val uri = QLSUtils.resolveImportURI(imp.importURI, imp.eResource)
			if (!imp.eResource.resourceSet.URIConverter.exists(uri, null)) {
				error("File " + uri + " not found", imp,
					imp.eClass.getEStructuralFeature(QLSPackage.IMPORT__IMPORT_URI))
			}
		}

	}

}
